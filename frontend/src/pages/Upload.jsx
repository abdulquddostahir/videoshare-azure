import React from 'react'
import { BlockBlobClient } from '@azure/storage-blob'
import { apiBase } from '../config'
export default function Upload(){const [file,setFile]=React.useState(null);const [meta,setMeta]=React.useState({title:'',publisher:'',producer:'',genre:'Music',ageRating:'PG'});const [status,setStatus]=React.useState('');const token=localStorage.getItem('token')||'';const onUpload=async()=>{if(!file) return alert('Choose a file');setStatus('Requesting SAS…');const sas=await (await fetch(apiBase()+'/videos/sasUploadUrl',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},body:JSON.stringify({filename:file.name,contentType:file.type})})).json();setStatus('Uploading to Blob…');const blob=new BlockBlobClient(sas.blobUrlWithSas);await blob.uploadBrowserData(file,{ blobHTTPHeaders:{ blobContentType:file.type }});setStatus('Registering metadata…');const saved=await (await fetch(apiBase()+'/videos',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},body:JSON.stringify({...meta,blobName:sas.blobName,contentType:file.type})})).json();setStatus('Done! Video ID: '+saved.id)};return(<div className='container'><h2>Upload a video (creators)</h2><div className='card'><label>File</label><input type='file' accept='video/*' onChange={e=>setFile(e.target.files[0])}/><label>Title</label><input value={meta.title} onChange={e=>setMeta({...meta,title:e.target.value})}/><label>Publisher</label><input value={meta.publisher} onChange={e=>setMeta({...meta,publisher:e.target.value})}/><label>Producer</label><input value={meta.producer} onChange={e=>setMeta({...meta,producer:e.target.value})}/><label>Genre</label><select value={meta.genre} onChange={e=>setMeta({...meta,genre:e.target.value})}>{['Music','Comedy','Education','Gaming','News','Sports','Other'].map(g=><option key={g} value={g}>{g}</option>)}</select><label>Age Rating</label><select value={meta.ageRating} onChange={e=>setMeta({...meta,ageRating:e.target.value})}>{['U','PG','12','15','18'].map(a=><option key={a} value={a}>{a}</option>)}</select><div style={{marginTop:'1rem'}}><button className='btn primary' onClick={onUpload}>Upload</button><span style={{marginLeft:'1rem'}} className='small'>{status}</span></div></div></div>)}

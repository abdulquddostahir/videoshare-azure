const { containers }=require('../utils.js');module.exports=async function(context,req){const adminKey=process.env.ADMIN_API_KEY||'';const input=req.body||{};const provided=(req.headers&&(req.headers['x-admin-key']||req.headers['X-Admin-Key']))||'';if(!adminKey||provided!==adminKey){context.res={status:403,body:{error:'Forbidden'}};return}if(!input.email){context.res={status:400,body:{error:'Email required'}};return}const {users}=await containers();const q=await users.items.query({query:'SELECT * FROM c WHERE c.email=@e',parameters:[{name:'@e',value:input.email.toLowerCase()}]}).fetchAll();const u=q.resources[0];if(!u){context.res={status:404,body:{error:'User not found'}};return}u.role='creator';await users.items.upsert(u);context.res={body:{ok:true,email:u.email,role:u.role}}}
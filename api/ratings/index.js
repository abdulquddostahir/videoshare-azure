const { containers, verify }=require('../utils.js');module.exports=async function(context,req){const claims=verify(req);if(!claims){context.res={status:401,body:{error:'Unauthorized'}};return}const {ratings}=await containers();const body=req.body||{};const id=`${body.videoId}:${claims.sub}`;const doc={id,videoId:body.videoId,userId:claims.sub,rating:Math.max(1,Math.min(5,Number(body.rating)||5)),updatedAt:new Date().toISOString()};await ratings.items.upsert(doc);context.res={body:doc}}
const { containers }=require('../utils.js');module.exports=async function(context,req){const qstr=(req.query&&req.query.q)||'';const genre=(req.query&&req.query.genre)||'';let query='SELECT c.id, c.title, c.genre, c.ageRating, c.publisher, c.createdAt FROM c WHERE 1=1';const params=[];if(qstr){query+=' AND CONTAINS(c.title, @q)';params.push({name:'@q',value:qstr})}if(genre){query+=' AND c.genre = @g';params.push({name:'@g',value:genre})}query+=' ORDER BY c.createdAt DESC';const {videos}=await containers();const res=await videos.items.query({query,parameters:params}).fetchAll();context.res={body:res.resources}}